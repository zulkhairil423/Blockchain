{"ast":null,"code":"System.register(\"../../lib/EventBus\", [], function () {\n  \"use strict\";\n\n  var __moduleName = \"../../lib/EventBus\";\n\n  var Emiter = require(\"events\").EventEmitter,\n      Event = require(\"./Event\"),\n      co = require(\"co\");\n\n  var EventBus = function EventBus(eventstore, repos) {\n    var $__0 = this;\n    this.repos = repos;\n    this.es = eventstore;\n    this.es.useEventPublisher(function (evt, cb) {\n      var event = Event.reborn(evt);\n      $__0.emit(evt.data.targetType + \".\" + evt.data.targetId + \":\" + evt.name, event);\n      $__0.emit(evt.data.targetType + \":\" + evt.name, event);\n      $__0.emit(\".\" + evt.data.targetId + \":\" + evt.name, event);\n      $__0.emit(\":\" + evt.name, event);\n      $__0.emit(evt.data.targetType, event);\n\n      if (evt.contextId) {\n        $__0.emit(evt.data.targetType + \".\" + evt.data.targetId + \":\" + evt.name + \"&\" + evt.contextId, event);\n        $__0.emit(evt.data.targetType + \":\" + evt.name + \"&\" + evt.contextId, event);\n        $__0.emit(\".\" + evt.data.targetId + \":\" + evt.name + \"&\" + evt.contextId, event);\n        $__0.emit(\":\" + evt.name + \"&\" + evt.contextId, event);\n        $__0.emit(evt.data.targetType + \"&\" + evt.contextId, event);\n      }\n    });\n    this.es.init();\n  };\n\n  $traceurRuntime.createClass(EventBus, {\n    publish: function (actor) {\n      this.es.getEventStream(actor.id, function (err, stream) {\n        if (actor.uncommittedEvents.length) {\n          stream.addEvents(actor.uncommittedEvents);\n          stream.commit();\n          actor.uncommittedEvents = [];\n        }\n      });\n    }\n  }, {}, Emiter);\n  module.exports = EventBus;\n  return {};\n});\nSystem.get(\"../../lib/EventBus\" + '');","map":{"version":3,"names":["System","register","__moduleName","Emiter","require","EventEmitter","Event","co","EventBus","eventstore","repos","$__0","es","useEventPublisher","evt","cb","event","reborn","emit","data","targetType","targetId","name","contextId","init","$traceurRuntime","createClass","publish","actor","getEventStream","id","err","stream","uncommittedEvents","length","addEvents","commit","module","exports","get"],"sources":["C:/Users/LeonyX/Documents/Blockchain/.vscode/loginpage/node_modules/domain/dist/lib/EventBus.js"],"sourcesContent":["System.register(\"../../lib/EventBus\", [], function() {\n  \"use strict\";\n  var __moduleName = \"../../lib/EventBus\";\n  var Emiter = require(\"events\").EventEmitter,\n      Event = require(\"./Event\"),\n      co = require(\"co\");\n  var EventBus = function EventBus(eventstore, repos) {\n    var $__0 = this;\n    this.repos = repos;\n    this.es = eventstore;\n    this.es.useEventPublisher((function(evt, cb) {\n      var event = Event.reborn(evt);\n      $__0.emit(evt.data.targetType + \".\" + evt.data.targetId + \":\" + evt.name, event);\n      $__0.emit(evt.data.targetType + \":\" + evt.name, event);\n      $__0.emit(\".\" + evt.data.targetId + \":\" + evt.name, event);\n      $__0.emit(\":\" + evt.name, event);\n      $__0.emit(evt.data.targetType, event);\n      if (evt.contextId) {\n        $__0.emit(evt.data.targetType + \".\" + evt.data.targetId + \":\" + evt.name + \"&\" + evt.contextId, event);\n        $__0.emit(evt.data.targetType + \":\" + evt.name + \"&\" + evt.contextId, event);\n        $__0.emit(\".\" + evt.data.targetId + \":\" + evt.name + \"&\" + evt.contextId, event);\n        $__0.emit(\":\" + evt.name + \"&\" + evt.contextId, event);\n        $__0.emit(evt.data.targetType + \"&\" + evt.contextId, event);\n      }\n    }));\n    this.es.init();\n  };\n  ($traceurRuntime.createClass)(EventBus, {publish: function(actor) {\n      this.es.getEventStream(actor.id, function(err, stream) {\n        if (actor.uncommittedEvents.length) {\n          stream.addEvents(actor.uncommittedEvents);\n          stream.commit();\n          actor.uncommittedEvents = [];\n        }\n      });\n    }}, {}, Emiter);\n  module.exports = EventBus;\n  return {};\n});\nSystem.get(\"../../lib/EventBus\" + '');\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}